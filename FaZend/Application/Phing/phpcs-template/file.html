<?php include dirname(__FILE__) . '/header.html'; ?>

<? if ($vars['quality']->revision): ?>
    <p>Revision <a href="#"><?=$vars['quality']->revision?></a>, commited by <?=$vars['quality']->author?><br/>
        <?=$vars['quality']->log?></p>
<? endif; ?>
    
<p><?=$vars['quality']->lines?> lines,
    <?=$vars['quality']->errors?> errors,
    <?=$vars['quality']->warnings?> warnings
    </p>
    
<? 
$errors = array();
foreach ($vars['info']->children() as $err) {
    $lineNo = (string)$err['line'];
    $type = (string)$err->getName();
    
    if (!isset($errors[$lineNo])) {
        $errors[$lineNo] = array();
        $errors[$lineNo]['cnt'] = 1;
    } else
        $errors[$lineNo]['cnt']++; 
    
    if (!isset($errors[$lineNo][$type]))
        $errors[$lineNo][$type] = array();
        
    $errors[$lineNo][$type][] = (string)$err; 
}
?>

    <table class="code">
        <thead><tr>
            <th width="60px" title="Line numbers" class="right">Line</th>
            <th></th>
        </tr></thead>
        <tbody>

    <? foreach (file($vars['source']) as $id=>$line): ?>
        <? $lineNo = $id+1 ?>
        <tr><th
            <?=(isset($errors[$lineNo]) ? " rowspan='2' class='errors'" : false)?>
            ><?=$lineNo?></th><td
            <?=(isset($errors[$lineNo]) ? " class='errors'" : false)?>
            ><?=$line?></td></tr>
     
        <? if (isset($errors[$lineNo])): ?>
            <tr><td class="comment">
            <? foreach (array('error', 'warning') as $type): ?>
                <? if (isset($errors[$lineNo][$type])): ?>
                    <? foreach ($errors[$lineNo][$type] as $err): ?>
                        <span class="<?=$type?>"><?=$err?></span><br/>
                    <? endforeach; ?>
                <? endif; ?>
            <? endforeach; ?>
            </td></tr>
        <? endif; ?>

    <? endforeach; ?>

    </tbody>
</table>

<?php include dirname(__FILE__) . '/footer.html'; ?>
